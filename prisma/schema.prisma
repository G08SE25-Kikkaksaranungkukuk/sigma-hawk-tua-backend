
generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  user_id          Int               @id @default(autoincrement())
  first_name       String
  middle_name      String?
  last_name        String
  birth_date       DateTime
  sex              String
  phone            String
  profile_url      String?
  social_credit    Int               @default(0)
  password         String
  email            String            @unique
  role             String            @default("USER")
  created_at       DateTime          @default(now())
  updated_at       DateTime          @updatedAt
  Belongs          Belongs[]
  headOf           Group[]           @relation("IsHeadOf")
  Interaction      Interaction[]     @relation("UserInteractions")
  requests         RequestJoin[]     @relation("UserRequests")
  userInterests    UserInterest[]    @relation("UserHasInterests")
  userTravelStyles UserTravelStyle[] @relation("UserHasTravelStyles")
  likes            LikeBlog[]        @relation("UserLikes")
  travelHistories  TravelHistory[]   @relation("UserHasTravelHistory")
}

model Interest {
  id             Int             @id @default(autoincrement())
  key            String          @unique
  label          String
  emoji          String
  color          String
  description    String?
  created_at     DateTime        @default(now())
  updated_at     DateTime        @updatedAt
  groupInterests GroupInterest[] @relation("InterestBelongsToGroups")
  userInterests  UserInterest[]  @relation("InterestBelongsToUsers")
  BlogInterest   BlogInterest[]

  @@map("interests")
}

model TravelStyle {
  id               Int               @id @default(autoincrement())
  key              String            @unique
  label            String
  emoji            String
  color            String
  description      String?
  created_at       DateTime          @default(now())
  updated_at       DateTime          @updatedAt
  userTravelStyles UserTravelStyle[] @relation("TravelStyleBelongsToUsers")

  @@map("travel_styles")
}

model UserInterest {
  id          Int      @id @default(autoincrement())
  user_id     Int
  interest_id Int
  created_at  DateTime @default(now())
  interest    Interest @relation("InterestBelongsToUsers", fields: [interest_id], references: [id], onDelete: Cascade)
  user        User     @relation("UserHasInterests", fields: [user_id], references: [user_id], onDelete: Cascade)

  @@unique([user_id, interest_id])
  @@map("user_interests")
}

model UserTravelStyle {
  id              Int         @id @default(autoincrement())
  user_id         Int
  travel_style_id Int
  created_at      DateTime    @default(now())
  travel_style    TravelStyle @relation("TravelStyleBelongsToUsers", fields: [travel_style_id], references: [id], onDelete: Cascade)
  user            User        @relation("UserHasTravelStyles", fields: [user_id], references: [user_id], onDelete: Cascade)

  @@unique([user_id, travel_style_id])
  @@map("user_travel_styles")
}

model Group {
  group_id        Int              @id @default(autoincrement())
  group_name      String
  group_leader_id Int
  description     String?
  profile_url     String?
  max_members     Int?             @default(10)
  created_at      DateTime         @default(now())
  updated_at      DateTime         @updatedAt
  Belongs         Belongs[]
  groupInterests  GroupInterest[]  @relation("GroupHasInterests")
  itineraries     GroupItinerary[] @relation("GroupHasItineraries")
  leader          User             @relation("IsHeadOf", fields: [group_leader_id], references: [user_id], onDelete: Cascade)
  requests        RequestJoin[]    @relation("GroupReceivesRequests")
  travelHistories TravelHistory[]  @relation("GroupHasTravelHistory")

  @@map("groups")
}

model RequestJoin {
  id         Int      @id @default(autoincrement())
  user_id    Int
  group_id   Int
  status     String   @default("PENDING")
  created_at DateTime @default(now())
  group      Group    @relation("GroupReceivesRequests", fields: [group_id], references: [group_id], onDelete: Cascade)
  user       User     @relation("UserRequests", fields: [user_id], references: [user_id], onDelete: Cascade)

  @@unique([user_id, group_id])
  @@map("request_joins")
}

model Interaction {
  id         Int      @id @default(autoincrement())
  message    String?
  like       Boolean?
  dislike    Boolean?
  picture    String?
  user_id    Int
  created_at DateTime @default(now())
  user       User     @relation("UserInteractions", fields: [user_id], references: [user_id], onDelete: Cascade)

  @@map("interactions")
}

model Itinerary {
  itinerary_id Int              @id @default(autoincrement())
  title        String?
  description  String?
  start_date   DateTime
  end_date     DateTime
  place_links  String[]         @default([])
  created_at   DateTime         @default(now())
  updated_at   DateTime         @updatedAt
  groups       GroupItinerary[] @relation("ItineraryBelongsToGroups")
  travelHistories TravelHistory[]  @relation("ItineraryHasTravelHistory")

  @@map("itineraries")
}

model Blog {
  blog_id       Int            @id @default(autoincrement())
  user_id       Int
  title         String
  description   String
  created_at    DateTime       @default(now())
  json_config   String
  html_output   String
  blog_interests BlogInterest[] @relation("BlogHasInterests")
  likes         LikeBlog[]      @relation("BlogLiked")

  @@map("blogs")
}

model BlogInterest {
  id          Int      @id @default(autoincrement())
  blog_id     Int
  interest_id Int
  created_at  DateTime @default(now())
  blog        Blog     @relation("BlogHasInterests", fields: [blog_id], references: [blog_id], onDelete: Cascade)
  interest    Interest @relation(fields: [interest_id], references: [id], onDelete: Cascade)

  @@unique([blog_id, interest_id])
  @@map("blog_interests")
}

model LikeBlog {
  like_id       Int             @id @default(autoincrement())
  user_id       Int
  blog_id       Int
  like_time     DateTime        @default(now())
  User          User            @relation("UserLikes", fields: [user_id], references: [user_id], onDelete: Cascade)
  blogs         Blog            @relation("BlogLiked", fields: [blog_id], references: [blog_id], onDelete: Cascade)

  @@unique([user_id, blog_id])
  @@map("like_blog")
}

model GroupItinerary {
  id           Int       @id @default(autoincrement())
  group_id     Int
  itinerary_id Int
  created_at   DateTime  @default(now())
  group        Group     @relation("GroupHasItineraries", fields: [group_id], references: [group_id], onDelete: Cascade)
  itinerary    Itinerary @relation("ItineraryBelongsToGroups", fields: [itinerary_id], references: [itinerary_id], onDelete: Cascade)

  @@unique([group_id, itinerary_id])
  @@map("group_itineraries")
}

model TravelHistory {
  id           Int       @id @default(autoincrement())
  group_id     Int?
  user_id      Int
  itinerary_id Int?
  created_at   DateTime  @default(now())
  expires_at   DateTime  @default(dbgenerated("NOW() + INTERVAL '1 year'"))
  group        Group?    @relation("GroupHasTravelHistory", fields: [group_id], references: [group_id], onDelete: SetNull)
  user         User      @relation("UserHasTravelHistory", fields: [user_id], references: [user_id], onDelete: Cascade)
  itinerary    Itinerary? @relation("ItineraryHasTravelHistory", fields: [itinerary_id], references: [itinerary_id], onDelete: SetNull)

  @@unique([group_id, user_id, itinerary_id])
  @@map("travel_history")
}

model GroupInterest {
  id          Int      @id @default(autoincrement())
  group_id    Int
  interest_id Int
  created_at  DateTime @default(now())
  group       Group    @relation("GroupHasInterests", fields: [group_id], references: [group_id], onDelete: Cascade)
  interest    Interest @relation("InterestBelongsToGroups", fields: [interest_id], references: [id], onDelete: Cascade)

  @@unique([group_id, interest_id])
  @@map("group_interests")
}

model Belongs {
  A         Int       
  B         Int
  groups    Group     @relation(fields: [A], references: [group_id], onDelete: Cascade)
  User      User      @relation(fields: [B], references: [user_id], onDelete: Cascade)

  @@id([A, B], map: "_Belongs_AB_pkey")
  @@index([B], map: "_Belongs_B_index")
  @@map("_Belongs")
}
